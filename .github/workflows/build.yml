name: CI

on:
  workflow_dispatch:

  issue_comment:
    types: [created]

jobs:
  build-el8stream:
    permissions:
      pull-requests: write
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_dispatch' ||
      ( github.event.issue.pull_request &&
        startsWith(github.event.comment.body, '/build') &&
        (
          github.event.comment.author_association == 'MEMBER' ||
          github.event.comment.author_association == 'COLLABORATOR'
        )
      )
    container:
      image: quay.io/ovirt/buildcontainer:el9stream
      options: --group-add qemu --user build --privileged

    steps:
    - name: Report back results
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        MESSAGE="Built images"
        curl -H "Authorization: Token ${GITHUB_TOKEN}" -X POST -d "{\“body\”: \“blah\”}" https://api.github.com/repos/oVirt/ost-images/issues/28/comments
